#include "dma.h"

#define DMA2EN 			(1U<<22)
#define DMA_SCR_EN		(1U<<0)
#define DMA_SCR_MINC 	(1U<<10)
#define DMA_SCR_PINC	(1U<<9)
#define DMA_SCR_TCIE	(1U<<4)
#define DMA_SCR_TEIE	(1U<<2)
#define DMA_SFCR_DMDIS	(1U<<2)

void dma2_mem2mem_config(void)
{
	/*enable clock access*/
	RCC->AHB1ENR = DMA2EN;

	/*disable dma stream*/
	 DMA2_Stream0->CR = 0;

	/*wait until stream is disabled*/
	 while(DMA2_Stream0->CR & DMA_SCR_EN);

	/*configure dma parameters*/
	 /*set memsize to half-word*/
	 DMA2_Stream0->CR |=  (1U<<13);
	 DMA2_Stream0->CR &= ~(1U<<14);

	 /*set perphsize to half-word*/
	 DMA2_Stream0->CR |= (1U<<11);
	 DMA2_Stream0->CR &= ~(1U<<12);

	 /*enable memory addr increment*/
	 DMA2_Stream0->CR |= DMA_SCR_MINC;

	 /*enable periph addr increment*/
	 DMA2_Stream0->CR |= DMA_SCR_PINC;

	 /*select mem2mem transfer*/
	 DMA2_Stream0->CR |= (1U<<7);
	 DMA2_Stream0->CR &= ~(1U<<6);

	/*disable direct mode*/
	 DMA2_Stream0->FCR |= DMA_SFCR_DMDIS;

	/*set dma fifo threshold*/
	 DMA2_Stream0->FCR |= (1U<<0);
	 DMA2_Stream0->FCR |= (1U<<1);

	/*enabla dma interrupt in nvic*/
	 NVIC_EnableIRQ(DMA2_Stream0_IRQn);

}


